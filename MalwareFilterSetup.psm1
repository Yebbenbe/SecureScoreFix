# MalwareFilterSetup.psm1
function MalwareFilter {
    param(
        [hashtable][ValidateNotNull()]$MalwareFilterParams
        )

    $policyName = $MalwareFilterParams['Name']

 try {
        New-MalwareFilterPolicy @MalwareFilterParams -QuarantineTag '$qPolicy'
        logMe -level "Info" -message "Malware Filter Policy '$policyName' created successfully. Creating rule."
        # Create and assign the policy to all domains
        New-MalwareFilterRule -Name "$policyName - All Domains" -MalwareFilterPolicy $policyName -RecipientDomainIs $domains
        logMe -level "Info" -message "Malware Filter Rule created for all domains with policy: $policyName."
    } catch {
        logMe -level "MalwareFilterSetup" -message "Error in MalwareFilter setup: $_"
    }
}